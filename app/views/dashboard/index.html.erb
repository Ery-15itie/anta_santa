<%# ログイン後のダッシュボード %>
<div class="container mx-auto p-4 sm:p-6 lg:p-8 min-h-screen bg-amber-50 font-serif">
  <div class="max-w-4xl mx-auto">
    
    <%# --- 1. ヘッダー --- %>
    <header class="text-center py-6 mb-8">
      <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight mb-2 text-gray-800">
        ようこそ、<%= @user.username %>さん!
      </h1>
      <p class="text-md sm:text-lg font-normal text-gray-600">
        あなたに届いた温かいメッセージを見てみましょう！
      </p>
    </header>

    <%# --- 2. 褒められた項目トップ3の表示 (個人統計) --- %>
    <div class="p-6 bg-white rounded-xl shadow-lg border border-gray-200 mb-12">
      <h2 class="text-xl font-semibold text-gray-700 mb-5 border-b pb-2">
        あなたのトップスキル (褒められた回数)
        <span class="text-sm font-normal text-gray-500 block mt-1">カテゴリーも確認できます。</span>
      </h2>
      
      <%# コントローラーの @top_scores は配列 of Hash: [{title: "...", category: "...", count: X}, ...] の形式 %>
      <% if @top_scores.present? %>
        <ol class="space-y-3">
          <% @top_scores.each.with_index(1) do |score_data, index| %>
            <li class="flex items-center justify-between p-3 rounded-lg <%= index == 1 ? 'bg-amber-100 border-amber-300' : 'bg-gray-50 border-gray-200' %> border">
              <span class="flex items-center">
                <%# 順位アイコン %>
                <span class="w-6 h-6 flex items-center justify-center text-white font-bold text-sm rounded-full mr-3
                  <%= index == 1 ? 'bg-amber-600' : (index == 2 ? 'bg-gray-500' : 'bg-red-500') %>">
                  <%= index %>
                </span>
                
                <%# スキルタイトルとカテゴリー %>
                <div>
                  <span class="text-md font-bold text-gray-800"><%= score_data[:title] %></span>
                  <span class="text-xs font-normal text-gray-500 block"> (<%= score_data[:category] %>)</span>
                </div>
              </span>
              <span class="text-xl font-extrabold text-red-600"><%= score_data[:count] %> 回</span>
            </li>
          <% end %>
        </ol>
      <% else %>
        <p class="text-gray-500 text-center py-4">まだ評価がありません。評価を受け取るとここに表示されます。</p>
      <% end %>
    </div>
    
    <%# --- 3. 統計情報カード (個人統計) --- %>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
      
      <%# もらったメッセージ %>
      <div class="stat-card bg-white p-6 rounded-xl shadow-md border border-gray-200 text-center transition duration-300 hover:shadow-lg">
        <div class="mb-3">
          <%= image_tag "icons/gift.png", alt: "もらったメッセージ", class: "h-12 w-12 mx-auto" %>
        </div>
        <p class="text-4xl font-bold text-amber-600 mb-1"><%= @total_received || 0 %></p>
        <p class="text-sm font-medium text-gray-500">もらったメッセージ</p>
      </div>

      <%# 褒められたポイント %>
      <div class="stat-card bg-white p-6 rounded-xl shadow-md border border-gray-200 text-center transition duration-300 hover:shadow-lg">
        <div class="mb-3">
          <%= image_tag "icons/star.png", alt: "褒められたポイント", class: "h-12 w-12 mx-auto" %>
        </div>
        <p class="text-4xl font-bold text-yellow-600 mb-1"><%= @total_checked_items || 0 %></p>
        <p class="text-sm font-medium text-gray-500">褒められたポイント</p>
      </div>

      <%#  送ったメッセージ %>
      <div class="stat-card bg-white p-6 rounded-xl shadow-md border border-gray-200 text-center transition duration-300 hover:shadow-lg">
        <div class="mb-3">
          <%= image_tag "icons/message.png", alt: "送ったメッセージ", class: "h-12 w-12 mx-auto" %>
        </div>
        <p class="text-4xl font-bold text-red-600 mb-1"><%= @total_given || 0 %></p>
        <p class="text-sm font-medium text-gray-500">送ったメッセージ</p>
      </div>
    </div>
    
    <%# --- 4. アクションセクション --- %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
      
      <%# 誰かを褒めてみよう %>
      <div class="p-8 bg-white rounded-xl shadow-lg border border-gray-200 text-center transition duration-300 hover:shadow-xl hover:border-amber-300">
        <%= image_tag "icons/send.png", alt: "サンタアイコン (褒める)", class: "mx-auto mb-4 w-16 h-16 object-contain" %>
        <h2 class="text-xl font-semibold text-gray-800 mb-2">誰かを褒めてみよう!</h2>
        <p class="text-sm text-gray-500 mb-6">仲間の素敵な活動を見つけて、温かいメッセージを送りましょう</p>
        <%= link_to "メッセージを送る", users_path, 
                    class: "inline-block px-8 py-3 bg-red-400 hover:bg-red-500 text-white font-bold rounded-full shadow-md transition duration-300 text-center" %>
      </div>

      <%# もらったメッセージを見る %>
      <div class="p-8 bg-white rounded-xl shadow-lg border border-gray-200 text-center transition duration-300 hover:shadow-xl hover:border-red-300">
        <%= image_tag "icons/list.png", alt: "メモ帳アイコン (メッセージ一覧)", class: "mx-auto mb-4 w-16 h-16 object-contain" %>
        <h2 class="text-xl font-semibold text-gray-800 mb-2">もらったメッセージを見る</h2>
        <p class="text-sm text-gray-500 mb-6">あなたに届いた温かいメッセージの一覧を確認できます</p>
        <%= link_to "メッセージ一覧へ", evaluations_path, 
                    class: "inline-block px-8 py-3 bg-amber-400 hover:bg-amber-500 text-white font-bold rounded-full shadow-md transition duration-300 text-center" %>
      </div>
    </div>

    <%# --- 5. 最近受け取ったメッセージ --- %>
    <div class="mb-10 p-6 bg-white rounded-xl shadow-lg border border-gray-200">
      <h2 class="text-xl font-semibold text-gray-700 mb-5 border-b pb-2">最近受け取ったメッセージ</h2>
      
      <% if @recent_received_evaluations.any? %>
        <div class="grid grid-cols-1 gap-4">
          <% @recent_received_evaluations.each do |evaluation| %>
            <div class="p-3 bg-gray-50 rounded-lg border border-gray-100 transition duration-300 hover:bg-amber-100">
              <h3 class="text-md font-bold text-gray-800 truncate mb-1">
                <%# evaluation.titleがないため、messageの冒頭を表示 %>
                <% message_preview = evaluation.message.to_s.truncate(40, separator: '...') %>
                <%= link_to message_preview, evaluation_path(evaluation), class: "text-red-600 hover:text-red-800" %>
              </h3>
              <p class="text-xs text-gray-500">
                From: <%= evaluation.evaluator.username %>さん | <%= l(evaluation.created_at, format: :short) %>
              </p>
            </div>
          <% end %>
        </div>
        <%= link_to "もっと見る", evaluations_path, class: "block mt-4 text-center text-sm text-red-500 hover:text-red-700 font-medium" %>
      <% else %>
        <div class="p-4 text-center bg-gray-50 rounded-lg border border-gray-200">
          <p class="text-gray-500">まだ誰もあなたを褒めていません。</p>
        </div>
      <% end %>
    </div>
    
    <%# --- 6. 最近評価してくれたユーザー --- %>
    <div class="mb-10 p-6 bg-white rounded-xl shadow-lg border border-gray-200">
      <h2 class="text-xl font-semibold text-gray-700 mb-5 border-b pb-2">最近褒めてくれたサンタさんたち</h2>
      
      <% if @recent_evaluators.any? %>
        <div class="flex flex-wrap gap-4 justify-center">
          <% @recent_evaluators.each do |evaluator| %>
            <%= link_to user_path(evaluator), class: "text-center hover:opacity-75 transition duration-300 p-2 rounded-lg bg-gray-50 border border-gray-200" do %>
              <span class="text-sm text-gray-700 block font-medium"><%= evaluator.username %></span>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-center py-4">まだ褒めてくれた人はいません。</p>
      <% end %>
    </div>

    <%# --- グローバル統計のセクション 予定 --- %>

  </div>
</div>
<%# ログイン画面: 暖かな家への帰宅 (Welcome Back Style) + 村ガイド %>

<div class="min-h-screen bg-[#271c19] font-serif pb-20 relative overflow-x-hidden text-[#3e2723]">
  
  <%# 背景: 夜の森 %>
  <div class="fixed inset-0 opacity-60 pointer-events-none" 
       style="background-image: radial-gradient(circle at 50% 30%, #4e342e 0%, #271c19 70%);">
  </div>
  <%# 雪のエフェクト %>
  <div class="fixed inset-0 opacity-20 pointer-events-none"
       style="background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCI+CjxjaXJjbGUgY3g9IjUiIGN5PSI1IiByPSIxIiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9IjAuNSIvPgo8L3N2Zz4='); background-size: 100px 100px;">
  </div>

  <div class="container mx-auto px-4 py-12 max-w-5xl relative z-10 flex flex-col items-center justify-center">
    
    <%# --- 1. ログインフォーム (このページ固有) --- %>
    <div class="w-full bg-white rounded-2xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] overflow-hidden mb-16 flex flex-col md:flex-row min-h-[550px] border-4 border-[#3e2723]">
      
      <%# 左側: 入力フォーム %>
      <div class="w-full md:w-1/2 p-8 sm:p-12 flex flex-col justify-center bg-[#fff8e1] relative">
        
        <div class="text-center mb-8">
          <h2 class="text-3xl font-black text-[#3e2723] tracking-widest mb-2" style="font-family: 'Courier New', Courier, monospace;">
            Log In
          </h2>
          <p class="text-sm text-[#8d6e63] font-bold uppercase tracking-wider">おかえりなさい、サンタさん</p>
        </div>

        <%# Turbo無効化 %>
        <%= form_for(resource, as: resource_name, url: session_path(resource_name), html: { class: "space-y-6", data: { turbo: false } }) do |f| %>
          
          <div>
            <%= f.label :email, "メールアドレス", class: "block text-xs font-bold text-[#ef6c00] mb-1" %>
            <%= f.email_field :email, autofocus: true, autocomplete: "email", placeholder: "santa@example.com",
                class: "w-full bg-white border border-[#ffcc80] text-[#3e2723] px-4 py-3 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#ef6c00] focus:border-transparent transition" %>
          </div>

          <div>
            <%= f.label :password, "パスワード", class: "block text-xs font-bold text-[#ef6c00] mb-1" %>
            <%= f.password_field :password, autocomplete: "current-password", placeholder: "••••••••",
                class: "w-full bg-white border border-[#ffcc80] text-[#3e2723] px-4 py-3 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#ef6c00] focus:border-transparent transition" %>
          </div>

          <div class="flex items-center justify-between text-sm">
            <% if devise_mapping.rememberable? %>
              <div class="flex items-center">
                <%= f.check_box :remember_me, class: "h-4 w-4 text-[#ef6c00] border-gray-300 rounded focus:ring-[#ef6c00]" %>
                <%= f.label :remember_me, "ログインしたままにする", class: "ml-2 text-[#5d4037] font-medium" %>
              </div>
            <% end %>
            
            <%= link_to "パスワードを忘れた方", new_password_path(resource_name), class: "text-[#8d6e63] hover:text-[#ef6c00] underline transition-colors" %>
          </div>

          <div class="pt-4">
            <%= f.submit "扉を開ける (ログイン)", 
                class: "w-full py-3 px-4 bg-gradient-to-r from-[#ef6c00] to-[#c62828] text-white font-bold rounded-full shadow-lg hover:from-[#f57c00] hover:to-[#d32f2f] hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 cursor-pointer border-2 border-[#fff3e0]" %>
          </div>
        <% end %>

        <%# ▼▼▼ Googleログインボタン  ▼▼▼ %>
        <div class="mt-6 text-center">
          <p class="text-xs text-[#8d6e63] mb-3 font-bold">—— または ——</p>
          <div class="w-full">
            <%# Tailwind CSSに合わせたスタイル + 下線(underline)を追加 %>
            <%= button_to "Googleアカウントでログイン / 新規登録", 
                user_google_oauth2_omniauth_authorize_path, 
                method: :post, 
                data: { turbo: false }, 
                class: "w-full py-3 px-4 bg-white border-2 border-[#8d6e63] text-[#5d4037] font-bold rounded-full shadow-sm hover:bg-[#d7ccc8] transition duration-200 cursor-pointer underline" %>
          </div>
        </div>
        <%# ▲▲▲ ここまで ▲▲▲ %>

        <%# ▼▼▼ 救済コード入力フォーム (Reactマウント用) ▼▼▼ %>
        <div class="my-6 border-t border-dashed border-[#d7ccc8]"></div>
        <div id="rescue-code-form-root"></div>

        <div class="mt-6 text-center pt-4 border-t border-[#ffe0b2]">
          <p class="text-xs text-[#8d6e63] mb-2">まだアカウントをお持ちでないですか？</p>
          <%= link_to new_registration_path(resource_name), class: "text-[#e65100] font-bold hover:text-[#bf360c] hover:underline inline-flex items-center gap-1" do %>
            <span>新規登録はこちら</span>
            <span>&rarr;</span>
          <% end %>
        </div>
      </div>

      <%# 右側: ウェルカムビジュアル (家の明かり) %>
      <div class="w-full md:w-1/2 p-10 lg:p-16 flex flex-col justify-center items-center text-center relative overflow-hidden text-white"
           style="background: linear-gradient(135deg, #bf360c 0%, #d84315 50%, #e64a19 100%);">
        <div class="absolute top-0 left-0 w-full h-full bg-black opacity-20 mix-blend-overlay"></div>
        <div class="relative z-10">
          <div class="w-24 h-24 bg-[#ffecb3] rounded-full mx-auto mb-6 shadow-[0_0_30px_rgba(255,236,179,0.6)] flex items-center justify-center text-5xl border-4 border-[#ffca28]">
            🏠
          </div>
          <h1 class="text-3xl lg:text-4xl font-black mb-4 drop-shadow-md font-serif">
            Welcome Back
          </h1>
          <p class="text-lg font-medium opacity-90 leading-relaxed">
            おかえりなさい<br>
            あなたの帰りを待っていました<br>
            <span class="text-sm mt-2 block opacity-80">さあ、温かい家の中へ</span>
          </p>
        </div>
        <div class="absolute bottom-0 left-0 right-0 h-12 bg-white opacity-20 rounded-t-[50%] filter blur-xl"></div>
      </div>
    </div>

    <%# --- 2. 共通コンテンツ (パーシャル読み込み) --- %>
    <%= render "devise/shared/village_guide" %>

  </div>
</div>
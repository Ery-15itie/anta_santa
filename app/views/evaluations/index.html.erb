<%# „É°„ÉÉ„Çª„Éº„Ç∏‰∏ÄË¶ß: „Ç¢„É≥„ÉÜ„Ç£„Éº„ÇØ„Å™Êú®„ÅÆÁßÅÊõ∏ÁÆ±È¢® %>

<div class="min-h-screen bg-[#2c1e1b] font-serif pb-20 relative overflow-x-hidden text-[#3e2723]">
  
  <%# ËÉåÊôØ: ÈáçÂéö„Å™Êú®„ÅÆ„ÉÜ„ÇØ„Çπ„ÉÅ„É£ %>
  <div class="fixed inset-0 opacity-40 pointer-events-none" 
       style="background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png');">
  </div>
  <%# ÈÉ®Â±ã„ÅÆÈöÖ„ÅÆÂΩ± %>
  <div class="fixed inset-0 pointer-events-none shadow-[inset_0_0_150px_rgba(0,0,0,0.7)]"></div>

  <div class="container mx-auto px-4 py-8 max-w-5xl relative z-10">

    <%# --- 1. Êàª„Çã„Éú„Çø„É≥ (ÁúüÈçÆ„ÅÆ„Éó„É¨„Éº„Éà‰ªò„ÅçÊú®„ÅÆÁúãÊùø) --- %>
    <div class="mb-8 text-left relative pl-2">
       <%= link_to dashboard_path, class: "inline-block group relative" do %>
         <%# Èéñ %>
         <div class="absolute -top-12 left-4 w-1 h-16 bg-[#5d4037] shadow-sm"></div>
         <%# ÁúãÊùø %>
         <div class="bg-[#4e342e] border-4 border-[#3e2723] px-5 py-2 rounded-sm shadow-[0_4px_6px_rgba(0,0,0,0.4)] transform group-hover:-translate-y-1 transition duration-300 flex items-center gap-3 relative overflow-hidden">
           <div class="absolute inset-0 border-2 border-[#cba36b] opacity-30 rounded-sm pointer-events-none"></div>
           <span class="text-[#cba36b] text-xl drop-shadow-md">üîô</span>
           <span class="text-[#ffecb3] font-bold text-sm tracking-[0.2em] uppercase text-shadow">GIFT HALL</span>
         </div>
       <% end %>
    </div>

    <%# --- 2. „Çø„Ç§„Éà„É´ --- %>
    <div class="text-center mb-2 relative">
      <h1 class="text-4xl font-black text-[#cba36b] tracking-[0.3em] uppercase drop-shadow-[0_2px_3px_rgba(0,0,0,0.5)] inline-block relative z-10" style="font-family: 'Georgia', serif;">
        My Mailbox
      </h1>
      <div class="text-[#a1887f] text-sm mt-2 italic">„ÅÇ„Å™„ÅüÂÆõ„Å¶„ÄÅ„Åù„Åó„Å¶„ÅÇ„Å™„Åü„ÅåÈÄÅ„Å£„ÅüÂ§ßÂàá„Å™ÊâãÁ¥ô„Åü„Å°</div>
    </div>

    <%# --- 3. „Ç≠„É£„Éì„Éç„ÉÉ„ÉàÊú¨‰Ωì --- %>
    <div class="mt-8 relative">
      
      <%# „Çø„ÉñÂàá„ÇäÊõø„Åà (Êú®„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„Éó„É¨„Éº„Éà) %>
      <% active_tab = params[:tab].presence || 'received' %>
      
      <div class="flex justify-center -mb-[4px] relative z-20 px-4 gap-1">
        <%# Âèó‰ø°„Çø„Éñ %>
        <%= link_to evaluations_path(tab: 'received'), class: "relative group overflow-hidden" do %>
          <div class="px-8 py-4 rounded-t-lg font-bold text-sm tracking-wider transition-all duration-300 transform 
                      #{active_tab == 'received' ? 'bg-[#5d4037] text-[#ffecb3] translate-y-0 shadow-[0_-4px_6px_rgba(0,0,0,0.3)] z-10 border-t-4 border-x-4 border-[#3e2723]' 
                                                 : 'bg-[#3e2723] text-[#a1887f] translate-y-2 hover:translate-y-1 hover:bg-[#4e342e] border-t-4 border-x-4 border-[#2c1e1b] opacity-80'}"
               style="clip-path: polygon(5% 0, 95% 0, 100% 100%, 0 100%);">
            <span class="relative z-10 flex items-center gap-2">
              <span class="<%= active_tab == 'received' ? 'text-[#cba36b]' : '' %>">üì•</span> 
              Âèó„ÅëÂèñ„Å£„ÅüÊâãÁ¥ô
              <span class="ml-2 bg-[#2c1e1b] text-[#cba36b] text-xs px-2 py-0.5 rounded-full shadow-inner"><%= @received_evaluations.count %></span>
            </span>
            <div class="absolute inset-0 bg-gradient-to-b from-[#ffffff10] to-transparent pointer-events-none"></div>
          </div>
        <% end %>

        <%# ÈÄÅ‰ø°„Çø„Éñ %>
        <%= link_to evaluations_path(tab: 'sent'), class: "relative group overflow-hidden" do %>
          <div class="px-8 py-4 rounded-t-lg font-bold text-sm tracking-wider transition-all duration-300 transform 
                      #{active_tab == 'sent' ? 'bg-[#5d4037] text-[#ffecb3] translate-y-0 shadow-[0_-4px_6px_rgba(0,0,0,0.3)] z-10 border-t-4 border-x-4 border-[#3e2723]' 
                                             : 'bg-[#3e2723] text-[#a1887f] translate-y-2 hover:translate-y-1 hover:bg-[#4e342e] border-t-4 border-x-4 border-[#2c1e1b] opacity-80'}"
               style="clip-path: polygon(5% 0, 95% 0, 100% 100%, 0 100%);">
            <span class="relative z-10 flex items-center gap-2">
              <span class="<%= active_tab == 'sent' ? 'text-[#cba36b]' : '' %>">üì§</span>
              ÈÄÅ„Å£„ÅüÊâãÁ¥ô
              <span class="ml-2 bg-[#2c1e1b] text-[#cba36b] text-xs px-2 py-0.5 rounded-full shadow-inner"><%= @sent_evaluations.count %></span>
            </span>
            <div class="absolute inset-0 bg-gradient-to-b from-[#ffffff10] to-transparent pointer-events-none"></div>
          </div>
        <% end %>
      </div>

      <%# „É°„ÉÉ„Çª„Éº„Ç∏„É™„Çπ„Éà („Ç≠„É£„Éì„Éç„ÉÉ„ÉàÂÜÖÈÉ®) %>
      <div class="bg-[#4e342e] min-h-[500px] p-6 sm:p-10 rounded-b-lg rounded-tr-lg shadow-[inset_0_10px_20px_rgba(0,0,0,0.5),0_10px_20px_rgba(0,0,0,0.3)] border-[12px] border-[#3e2723] relative z-10 relative overflow-hidden">
        
        <%# ÂÜÖÈÉ®„ÅÆË≥™ÊÑü %>
        <div class="absolute inset-0 opacity-30 pointer-events-none" style="background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png'); filter: brightness(0.5);"></div>

        <%# Ë°®Á§∫„Åô„Çã„Éá„Éº„Çø„ÅÆÊ±∫ÂÆö %>
        <% 
           evaluations_to_display = active_tab == 'received' ? @received_evaluations : @sent_evaluations 
        %>

        <% if evaluations_to_display.any? %>
          <div class="grid grid-cols-1 gap-6 relative z-10">
            <% evaluations_to_display.each do |evaluation| %>
              <% 
                 # Áõ∏Êâã„É¶„Éº„Ç∂„Éº„ÅÆÁâπÂÆö
                 target_user = active_tab == 'received' ? evaluation.evaluator : evaluation.evaluated_user
                 target_username = target_user&.username || '‰∏çÊòé„Å™„É¶„Éº„Ç∂„Éº'
                 target_initial = target_username[0]&.upcase || '?'
              %>
              
              <%# Â∞ÅÁ≠í„Ç´„Éº„Éâ („ÇØ„É©„Éï„ÉàÁ¥ôÈ¢®) %>
              <div class="group relative bg-[#d7ccc8] p-1 rounded-sm shadow-[0_4px_8px_rgba(0,0,0,0.3)] hover:shadow-[0_8px_16px_rgba(0,0,0,0.4)] transition-all duration-300 transform hover:-translate-x-1 hover:-translate-y-1 cursor-pointer overflow-hidden border-t border-l border-[#ffffff30] border-b-2 border-r-2 border-[#3e2723]">
                <%= link_to evaluation_path(evaluation), class: "absolute inset-0 z-20" do %><% end %>

                <%# Â∞ÅÁ≠í„ÅÆ‰∏≠Ë∫´ %>
                <div class="bg-[#efebe9] p-5 rounded-sm relative overflow-hidden" style="background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png');">
                  
                  <%# Ë£ÖÈ£æ: Â∞ÅËùã„Å®Á¥ê %>
                  <div class="absolute top-4 left-4 z-10">
                    <div class="w-16 h-16 rounded-full bg-[#8d6e63] border-4 border-[#5d4037] shadow-md flex items-center justify-center text-[#ffecb3] text-2xl font-bold relative" style="box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);">
                      <span style="filter: drop-shadow(0 1px 1px rgba(0,0,0,0.5));"><%= target_initial %></span>
                      <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-4 h-6 bg-[#8d6e63] rounded-full opacity-80"></div>
                    </div>
                  </div>
                  
                  <div class="flex flex-col sm:flex-row gap-4 justify-between sm:items-center pl-20 relative z-0">
                    <div>
                      <p class="text-xs font-bold text-[#8d6e63] uppercase tracking-wider mb-1 flex items-center gap-1">
                        <%= active_tab == 'received' ? 'From:' : 'To:' %>
                        <span class="h-px w-8 bg-[#8d6e63] opacity-50 inline-block ml-1"></span>
                      </p>
                      <h3 class="text-xl font-black text-[#3e2723] font-serif">
                        <%= target_username %>
                      </h3>
                      <p class="text-xs text-[#a1887f] mt-1 font-mono flex items-center gap-1">
                        <span>üìÖ</span> <%= l(evaluation.created_at, format: :short) %>
                      </p>
                    </div>

                    <%# „É°„ÉÉ„Çª„Éº„Ç∏ÊäúÁ≤ã %>
                    <div class="flex-grow px-2 sm:px-8 relative">
                      <span class="text-4xl text-[#d7ccc8] absolute -top-2 -left-2 opacity-50">‚Äú</span>
                      <p class="text-[#5d4037] text-sm italic line-clamp-2 leading-relaxed font-medium" style="font-family: 'Georgia', serif;">
                        <%= evaluation.message.presence || "Ôºà„É°„ÉÉ„Çª„Éº„Ç∏Êú¨Êñá„Å™„ÅóÔºâ" %>
                      </p>
                      <span class="text-4xl text-[#d7ccc8] absolute -bottom-4 -right-0 opacity-50">‚Äù</span>
                    </div>

                    <%# OPEN„Éú„Çø„É≥ %>
                    <div class="shrink-0 text-right">
                      <span class="inline-flex items-center gap-1 px-3 py-1 border-2 border-[#8d6e63] text-[#5d4037] text-xs font-bold rounded-sm group-hover:bg-[#8d6e63] group-hover:text-[#ffecb3] transition shadow-sm">
                        <span>‚úâÔ∏è</span> OPEN
                      </span>
                    </div>
                  </div>
                  
                  <%# Â∞ÅÁ≠í„ÅÆÁ¥ê (Âè≥Á´Ø„ÅÆË£ÖÈ£æ) %>
                  <div class="absolute top-0 bottom-0 right-6 w-1 bg-[#a1887f] opacity-30 shadow-sm z-10"></div>
                   <div class="absolute top-1/2 right-4 w-5 h-5 bg-[#a1887f] rounded-full shadow-md z-20 transform -translate-y-1/2 border-2 border-[#8d6e63]"></div>

                </div>
              </div>
            <% end %>
          </div>

                <% else %>
          <%# Á©∫„ÅÆÁä∂ÊÖã („Ç¢„Ç§„Ç≥„É≥„Å™„Åó„ÄÅÁúüÈçÆ„Éó„É¨„Éº„Éà„ÅÆÊñáÂ≠ó„ÅÆ„Åø) %>
          <div class="h-full flex flex-col items-center justify-center py-32 text-center relative z-10 bg-[#3e2723] bg-opacity-30 rounded-lg shadow-[inset_0_2px_10px_rgba(0,0,0,0.6)] border-2 border-[#5d4037] border-opacity-50 mx-4 my-8 overflow-hidden">
            
            <%# ÁúüÈçÆ„Éó„É¨„Éº„ÉàÈ¢®„ÅÆÊû†Ë£ÖÈ£æ %>
            <div class="absolute inset-0 m-4 border-4 border-[#cba36b] border-double opacity-40 rounded-sm pointer-events-none"></div>

            <%# „É°„Ç§„É≥„ÉÜ„Ç≠„Çπ„Éà (Â∑®Â§ß„Å™ÁúüÈçÆÂàªÂç∞) %>
            <p class="text-4xl sm:text-5xl font-black text-[#cba36b] mb-6 uppercase tracking-[0.2em] drop-shadow-[2px_4px_6px_rgba(0,0,0,0.8)] relative z-10 px-4 py-2" style="font-family: 'Georgia', serif; border-bottom: 2px solid #cba36b50; border-top: 2px solid #cba36b50;">
              Cabinet is Empty
            </p>
            
            <%# „Çµ„Éñ„ÉÜ„Ç≠„Çπ„Éà (Êòé„Çã„ÅÑ„Éô„Éº„Ç∏„É•) %>
            <p class="text-2xl text-[#ffecb3] font-medium italic drop-shadow-[1px_2px_3px_rgba(0,0,0,0.9)] opacity-90 relative z-10">
              <%= active_tab == 'received' ? '„Åæ„Å†ÊâãÁ¥ô„ÅØÂ±ä„ÅÑ„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ' : '„Åæ„Å†ÊâãÁ¥ô„ÇíÈÄÅ„Å£„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ' %>
            </p>
            
            <%# Ë£ÖÈ£æÔºö„Ç≠„É£„Éì„Éç„ÉÉ„ÉàÂ••„ÅÆÂæÆ„Åã„Å™ÂÖâ %>
            <div class="absolute inset-0 bg-gradient-to-t from-[#cba36b10] via-transparent to-transparent pointer-events-none"></div>
          </div>
        <% end %>
        
        <%# Ê£öÊùø„É©„Ç§„É≥ %>
        <div class="absolute top-1/3 left-0 right-0 h-1 bg-[#3e2723] opacity-20 shadow-sm pointer-events-none"></div>
        <div class="absolute top-2/3 left-0 right-0 h-1 bg-[#3e2723] opacity-20 shadow-sm pointer-events-none"></div>
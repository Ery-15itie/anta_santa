<%# 評価一覧ページ %>
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <%# ダッシュボードに戻るボタンを追加 %>
      <div class="mb-4 text-start">
        <%= link_to dashboard_path, class: "btn btn-outline-secondary btn-sm rounded-pill" do %>
          <i class="fas fa-arrow-left me-1"></i> ダッシュボードに戻る
        <% end %>
      </div>

      <h1 class="text-center mb-4 text-primary fw-bold">メッセージ一覧</h1>
      <p class="text-center text-muted mb-5">あなたに届いた、仲間からの温かいメッセージを確認しましょう。</p>

      <div class="mb-4 text-end">
        <%= link_to new_evaluation_path, class: "btn btn-lg btn-success rounded-pill shadow-lg" do %>
          <i class="fas fa-paper-plane me-2"></i> 新しいメッセージを送る
        <% end %>
      </div>

      <%# タブナビゲーション %>
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="received-tab" data-bs-toggle="tab" data-bs-target="#received-messages" type="button" role="tab" aria-controls="received-messages" aria-selected="true">
            もらったメッセージ (<%= @evaluations_received.count %>)
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="sent-tab" data-bs-toggle="tab" data-bs-target="#sent-messages" type="button" role="tab" aria-controls="sent-messages" aria-selected="false">
            送ったメッセージ (<%= @evaluations_given.count %>)
          </button>
        </li>
      </ul>

      <%# タブコンテンツ %>
      <div class="tab-content border border-top-0 p-4 bg-white shadow-sm">
        
        <%# === 1. もらったメッセージ (Evaluations Received) === %>
        <div class="tab-pane fade show active" id="received-messages" role="tabpanel" aria-labelledby="received-tab">
          <% if @evaluations_received.any? %>
            <table class="table table-hover table-striped">
              <thead class="table-light">
                <tr>
                  <th>タイトル</th>
                  <th>送信者</th>
                  <th>日付</th>
                  <th class="text-center">詳細</th>
                </tr>
              </thead>
              <tbody>
                <% @evaluations_received.each do |evaluation| %>
                  <tr>
                    <td><%= evaluation.title %></td>
                    <td><%= evaluation.evaluator.name %></td>
                    <td><%= l(evaluation.created_at, format: :short) %></td>
                    <td class="text-center">
                      <%= link_to "詳細を見る", evaluation_path(evaluation), class: "btn btn-sm btn-info text-white" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% else %>
            <div class="alert alert-info text-center" role="alert">
              まだメッセージが届いていません。仲間からの評価を待ちましょう！
            </div>
          <% end %>
        </div>

        <%# === 2. 送ったメッセージ (Evaluations Given) === %>
        <div class="tab-pane fade" id="sent-messages" role="tabpanel" aria-labelledby="sent-tab">
          <% if @evaluations_given.any? %>
            <table class="table table-hover table-striped">
              <thead class="table-light">
                <tr>
                  <th>タイトル</th>
                  <th>評価対象者</th>
                  <th>日付</th>
                  <th class="text-center">詳細</th>
                </tr>
              </thead>
              <tbody>
                <% @evaluations_given.each do |evaluation| %>
                  <tr>
                    <td><%= evaluation.title %></td>
                    <td><%= evaluation.evaluated_user.name %></td>
                    <td><%= l(evaluation.created_at, format: :short) %></td>
                    <td class="text-center">
                      <%= link_to "詳細を見る", evaluation_path(evaluation), class: "btn btn-sm btn-info text-white" %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% else %>
            <div class="alert alert-info text-center" role="alert">
              このタブには、あなたが送ったメッセージの一覧が表示されます。
            </div>
          <% end %>
        </div>
        
      </div>
    </div>
  </div>
</div>
<%# ユーザー一覧: 郵便局の住所録 (Address Book) デザイン %>

<div class="min-h-screen bg-[#3e2723] font-serif pb-20 relative overflow-x-hidden text-[#3e2723]">
  
  <%# 背景テクスチャ（木目） %>
  <div class="fixed inset-0 opacity-20 pointer-events-none" 
       style="background-image: repeating-linear-gradient(45deg, #3e2723 25%, #4e342e 25%, #4e342e 50%, #3e2723 50%, #3e2723 75%, #4e342e 75%, #4e342e 100%); background-size: 20px 20px;">
  </div>

  <div class="container mx-auto px-4 py-8 max-w-4xl relative z-10">
    
    <%# --- 1. ヘッダー (木の看板風) --- %>
    <div class="text-center mb-10">
      <div class="inline-block relative">
        <%# 看板の吊り下げ紐 %>
        <div class="absolute -top-16 left-1/4 w-1 h-20 bg-[#8d6e63] z-0"></div>
        <div class="absolute -top-16 right-1/4 w-1 h-20 bg-[#8d6e63] z-0"></div>
        
        <%# 看板本体 %>
        <div class="relative bg-[#5d4037] border-4 border-[#3e2723] px-10 py-4 rounded shadow-xl transform rotate-1">
          <h1 class="text-3xl font-black text-[#ffecb3] tracking-widest uppercase drop-shadow-md" style="font-family: 'Courier New', Courier, monospace;">
            Address Book
          </h1>
          <div class="absolute top-1 left-1 w-full h-full border border-[#ffffff20] rounded pointer-events-none"></div>
        </div>
      </div>
      <p class="mt-6 text-[#ffecb3] text-sm tracking-wider shadow-black drop-shadow-md">
        お手紙を送る相手をここから探しましょう
      </p>
    </div>

        <%# --- 2. 検索フォーム & フレンドリンク (デスクの上のメモ帳風) --- %>
    <div class="bg-[#fdf6e3] p-6 rounded shadow-lg border-4 border-[#8d6e63] mb-10 relative">
      <%# クリップ装飾 %>
      <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 w-16 h-8 bg-stone-400 rounded-full border-4 border-[#5d4037]"></div>

      <%# htmlオプションの中に data: { turbo: false } を追加%>
      <%= form_with url: users_path, method: :get, local: true, html: { class: "flex flex-col sm:flex-row gap-3 mb-6", data: { turbo: false } } do |f| %>
        <div class="flex-grow relative">
          <%= text_field_tag :search, params[:search], 
                             placeholder: "Find user...", 
                             class: "w-full px-4 py-3 bg-transparent border-b-2 border-[#8d6e63] text-[#3e2723] placeholder-[#a1887f] focus:outline-none focus:border-[#d32f2f] transition font-mono text-lg" %>
        </div>
        
        <%= button_tag type: 'submit', class: "flex items-center justify-center px-6 py-3 bg-[#5d4037] text-[#ffecb3] font-bold rounded shadow hover:bg-[#3e2723] transition border border-[#3e2723]" do %>
          <span>Search 🔍</span>
        <% end %>
      <% end %>

      <%# フレンド一覧へのリンク %>
      <div class="text-center border-t border-dashed border-[#8d6e63] pt-4">
        <%= link_to following_users_path, class: "inline-flex items-center text-[#d32f2f] font-bold hover:text-[#b71c1c] transition group" do %>
          <span class="border-b border-[#d32f2f] group-hover:border-[#b71c1c] pb-0.5">
            Check Friend List &rarr;
          </span>
        <% end %>
      </div>
    </div>

    
    <%# --- 3. ユーザーリスト (インデックスカード風) --- %>
    <div class="grid grid-cols-1 gap-4">
      <% if @users.any? %>
        <% @users.each do |user| %>
          <div class="flex flex-col sm:flex-row items-center p-5 bg-[#fff8e1] rounded shadow-md border-l-8 border-[#8d6e63] hover:border-[#d32f2f] transition duration-300 group relative">
            
            <%# 紙の質感 %>
            <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: linear-gradient(#000 1px, transparent 1px); background-size: 100% 2em;"></div>

            <div class="flex items-center flex-grow w-full sm:w-auto mb-4 sm:mb-0 z-10">
              <div class="w-14 h-14 rounded-full bg-[#efebe9] border-2 border-dashed border-[#8d6e63] flex items-center justify-center text-[#5d4037] text-xl font-bold mr-4 shadow-inner">
                <%= user.username.to_s[0].upcase %>
              </div>
              <div>
                <%= link_to user.username, user_path(user), class: "text-xl font-bold text-[#3e2723] hover:text-[#d32f2f] transition font-serif border-b border-transparent hover:border-[#d32f2f]" %>
                <p class="text-xs text-[#8d6e63] font-mono mt-1">ID: <%= user.id %></p>
              </div>
            </div>
            
            <%# --- ボタンエリア --- %>
            <div class="flex items-center gap-3 w-full sm:w-auto z-10">
              
              <%# 1. フォローボタン (パーシャル) %>
              <div class="flex-shrink-0">
                <%= render 'users/follow_form', user: user %>
              </div>
              
              <%# 2. お手紙を送るボタン %>
              <%# data: { turbo: false } を追加して動作するように修正 %>
              <%= link_to new_evaluation_path(receiver_id: user.id), 
                  class: 'flex items-center gap-2 px-4 py-2 bg-[#3e2723] text-[#ffecb3] text-sm font-bold rounded shadow hover:bg-[#271c19] transition border border-[#5d4037]',
                  data: { turbo: false } do %>
                  <span>お手紙を送る</span>
              <% end %>
            </div>
            
          </div>
        <% end %>
      <% else %>
        <%# ユーザーが見つからない場合 %>
        <div class="text-center py-12 bg-[#fdf6e3] rounded shadow-lg border-2 border-dashed border-[#d7ccc8]">
          <p class="text-lg font-bold text-[#8d6e63] mb-2">No Users Found</p>
          <p class="text-sm text-[#a1887f]">
            <% if params[:search].present? %>
              "<%= params[:search] %>" に一致する宛先は見つかりませんでした。
            <% else %>
              まだ他のユーザーがいません。
            <% end %>
          </p>
        </div>
      <% end %>
    </div>

  </div>
</div>